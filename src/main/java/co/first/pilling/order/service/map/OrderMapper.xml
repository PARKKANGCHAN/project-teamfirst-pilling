<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="co.first.pilling.order.service.map.OrderMapper">
	<select id="orderSelectList">
		SELECT * FROM `order`
	</select>
	<select id="orderSelect">
		SELECT * FROM `order` WHERE ORDER_ID = #{orderId}
	</select>
	<select id="getOrderListByUserNo">
		SELECT o.order_id AS orderId, p.product_name AS productName, o.order_date AS orderDate,
			   count(p.product_name) AS count, o.order_totalprice AS orderTotalprice, os.orderstatus_name AS orderstatusName
		FROM `order` o
   LEFT JOIN orderdetail od 
		  ON o.order_id = od.order_id
   LEFT JOIN product p 
		  ON od.product_id = p.product_id
   LEFT JOIN orderstatus os
		  ON o.orderstatus_id = os.orderstatus_id
	   WHERE o.user_no = #{userNo}
	     AND NOT product_name IS NULL
	GROUP BY o.order_id
	</select>
	<select id="createOrderNo">
		SELECT COALESCE(MAX(order_id), 0) + 1 AS orderId FROM
		`order` WHERE user_no =
		#{userNo} ORDER BY order_id DESC LIMIT 1;
	</select>
	<insert id="orderInsert">
		INSERT INTO `order` (order_id, user_no, product_id,
		orderstatus_id, order_totalprice,
		order_refund, order_card)
		VALUES
		(#{orderId},
		#{userNo},#{productId},#{orderstatusId},#{orderTotalprice},#{orderRefund},#{orderCard})
	</insert>
	<delete id="orderDelete">
		DELETE FROM `order` WHERE ORDER_ID = #{orderId}
		AND
		ORDERSTATUS_ID ="2"
	</delete>
	<update id="orderUpdate">
		UPDATE `order`
		SET ORDERSTATUS_ID="1"
		WHERE ORDER_ID =
		#{orderId}
	</update>
</mapper>